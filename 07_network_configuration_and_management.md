# 7 章 ネットワークの設定と管理

Linux はサーバー用途で利用されることが多く、ネットワーク接続が重要になります。本章では、ネットワーク接続に必要な基礎知識、確認コマンド、設定方法について学びます。

---

### 本章の内容

- IP アドレスの確認
- ping コマンドによる通信確認
- 名前解決の確認
- ルーティングの確認

---

## 目次

- [7-1 IP アドレスの確認](#7-1-ip-アドレスの確認)
  - [7-1-1 ローカルループバックアドレス](#7-1-1-ローカルループバックアドレス)
  - [7-1-2 外部通信用の IP アドレス](#7-1-2-外部通信用の-ip-アドレス)
  - [7-1-3 内部通信用の IP アドレス](#7-1-3-内部通信用の-ip-アドレス)
- [7-2 ping コマンドによる IP 通信の確認](#7-2-ping-コマンドによる-ip-通信の確認)
- [7-3 名前解決の確認](#7-3-名前解決の確認)
- [7-4 ルーティングの確認](#7-4-ルーティングの確認-要約)

---

## 7-1 IP アドレスの確認

Linux に設定されている IP アドレスは **`ip` コマンド** で確認します。  
`ip` はネットワーク関連の情報表示に使われ、サブコマンド `address` でインターフェースの情報を取得できます。  
インターフェースを省略すると全てのインターフェースを表示します。

#### 書式

ip a[ddress] [インターフェース]

↑ これは ip address でも ip a どちらでも良い

#### 実行例

```bash

$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 ...
    inet 127.0.0.1/8 scope host lo
    inet6 ::1/128 scope host

2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 ...
    inet 10.0.2.15/24 brd 10.0.2.255 scope global dynamic

3: enp0s8: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 ...
    inet 192.168.56.3/24 brd 192.168.56.255 scope global dynamic


```

#### ポイント

- lo … ループバックインターフェース（127.0.0.1）

- enp0s3 … NAT 接続のインターフェース（例: 10.0.2.15）

- enp0s8 … ホストオンリー接続のインターフェース（例: 192.168.56.3）

このように複数のインターフェースを持つ場合、それぞれ用途が異なります。

---

### 7-1-1 ローカルループバックアドレス

- **インターフェース名**: `lo`
- **用途**: 自分自身と通信するため（ローカルループバック）
- **割り当て IP**: `127.0.0.1`

---

### 7-1-2 外部通信用の IP アドレス

- **インターフェース名**: `enp0s3`
- **用途**: NAT を利用して外部（インターネット）と通信
- **割り当て IP**: 例 `10.0.2.15`

---

### 7-1-3 内部通信用の IP アドレス

- **インターフェース名**: `enp0s8`
- **用途**: ホストオンリーネットワークによるホスト OS との通信
- **割り当て IP**: 例 `192.168.56.3`

---

#### まとめ表

| インターフェース | 用途                       | 割り当て IP 例 |
| ---------------- | -------------------------- | -------------- |
| `lo`             | 自分自身との通信           | `127.0.0.1`    |
| `enp0s3`         | 外部（インターネット）通信 | `10.0.2.15`    |
| `enp0s8`         | ホスト OS との通信         | `192.168.56.3` |

---

# 7-2 ping コマンドによる IP 通信の確認 要約

#### ポイント

- **通信確認**

  - IP 通信の確認には `ping` コマンドを使用する。
  - 書式：`ping IPアドレスまたはホスト名`
  - インターネット上のサーバーにも通信確認可能。

- **実行例**

  ```bash

  $ ping linuc.org
  PING linuc.org (219.94.236.161) ...
  64 bytes from 219.94.236.161: icmp_seq=1 ttl=255 time=16.3 ms
  64 bytes from 219.94.236.161: icmp_seq=2 ttl=255 time=15.7 ms
  ^C
  --- linuc.org ping statistics ---
  2 packets transmitted, 2 received, 0% packet loss
  rtt min/avg/max/mdev = 15.668/15.991/16.315/0.323 ms

  ```

#### 特徴

- ping は停止しない限り通信確認を繰り返す。

- 停止方法：Ctrl + c

- 結果には通信往復時間（RTT: Round Trip Time）が表示される。

#### 考え方

- 遠距離の通信 → 遅延が大きくなる。

- 近距離でも遅い → ネットワーク混雑 or 障害の可能性。

#### 注意点

- ping は ICMP Echo を使用。

- 相手が ICMP Echo に応答しない設定 の場合、結果が返らない。

- 応答がない = 通信不可 ではなく、セキュリティ上の設定である可能性がある。

---

### 7-3 名前解決の確認

#### ポイント

- **名前解決とは**

  - ホスト名を IP アドレスに変換する仕組み。
  - Web サーバーやメールサーバーでの通信に必須。
  - インターネット上の通信を IP アドレス直指定で行うのは不便なため、ホスト名で管理。

- **仕組み**

  - 組織はドメイン名を取得し、コンピューターにホスト名を割り当てる。
  - 割り当てたホスト名と IP アドレスの組み合わせを名前解決で調べられるようにする。
  - 最もよく使われる仕組みは **DNS（Domain Name System）**。

- **名前解決の確認**
  - `dig` コマンドで確認できる。
  - 書式：`dig ホスト名`
  - 実行例：
    ```bash
    $ dig www.linuc.org
    ;; ANSWER SECTION:
    www.linuc.org. 3588 IN A 219.94.236.161
    ```
    - ANSWER SECTION に IP アドレスが表示されていれば名前解決成功。

#### 参照 DNS の確認

- DNS サーバーに名前解決リクエストを送ることで IP アドレスが取得される。
- 参照している DNS は `/etc/resolv.conf` に記述されている。

```bash

$ cat /etc/resolv.conf
nameserver 10.0.2.3
nameserver fd00::3

```

- この例では 10.0.2.3 が DNS サーバー。

- 注意：このファイルは NetworkManager によって自動生成される。

- 直接修正せず、NetworkManager の設定変更方法に従うこと。

---

### 7-4 ルーティングの確認 要約

#### ポイント

- **ルーティングとは**

  - LAN 内のコンピューター同士は直接通信可能。
  - 他 LAN やインターネット上のコンピューターと通信する場合はルーターを介して通信。
  - ルーターを介した通信を **ルーティング** と呼ぶ。

- **デフォルトゲートウェイ**

  - 外部ネットワークと通信する際のデフォルトルーター。

- **設定の確認**
  - `ip route` コマンドで確認できる

```bash

$ ip route
default via 10.0.2.2 dev enp0s3 proto dhcp src 10.0.2.15 metric 100
10.0.2.0/24 dev enp0s3 proto kernel scope link src 10.0.2.15 metric 100
192.168.56.0/24 dev enp0s8 proto kernel scope link src 192.168.56.3 metric 101

```

<img src="images/ルーティングの例.png" alt="ルーティング設定例" width="600">

- 1 行目: デフォルトゲートウェイが 10.0.2.2、通信には enp0s3 を使用。

- 2 行目: NAT で接続されているネットワーク 10.0.2.0/24 とは enp0s3 を使用。

- 3 行目: ホストオンリーネットワーク 192.168.56.0/24 とは enp0s8 を使用。

#### 注意点

- 外部通信できない場合は、まず自分のコンピューターのルーティング設定を確認する。

---
