# 6 章 ファイルやディレクトリのアクセス制御

Linux はマルチユーザー OS であるため、セキュリティ保護の観点からファイルやディレクトリにはアクセス制御が必要です。  
アクセス制御は「所有者」や「所有グループ」、それぞれに設定される **アクセス権** によって実現されます。

## 本章の内容

- ファイルの所有者と所有グループ
- ファイルとアクセス権

## 6-1 ファイルの所有者と所有グループ

- 各ファイルやディレクトリには **所有者（ユーザー）** と **所有グループ** が設定される。
- ファイルを作成した場合
  - 所有者 → 作成したユーザー
  - 所有グループ → そのユーザーのプライマリーグループ
- この所有権に基づきアクセス制御が行われる。

---

### 6-1-1 所有者と所有グループの確認

#### 概要

Linux のファイルには **所有者（ユーザー）** と **所有グループ** が設定されており、  
「誰が利用できるか、どんな操作ができるか」を管理する。

#### 確認方法

`ls -l` コマンドで確認できる。

```bash

$ touch test

$ ls -l test

-rw-r--r--. 1 linuc linuc 0 8月16 10:44 test

```

#### 表示内容

- -rw-r--r-- : アクセス権（ユーザー / グループ / その他）

- 3 番目の項目 : 所有者（例: linuc ユーザー）

- 4 番目の項目 : 所有グループ（例: linuc グループ）

#### ポイント

- 所有者 : ファイルの持ち主ユーザー

- 所有グループ : ファイルに関連付けられたグループ

- アクセス権はこれらに基づいて適用される

---

### 6-1-2 所有者の変更

## 概要

ファイルやディレクトリの **所有者** を変更するには `chown` コマンドを使用する。  
また、指定方法によって **所有グループ** も同時に変更できる。

> 所有者・所有グループの変更には **root 権限** が必要。

---

### 書式

chown [オプション] [ユーザー]:[グループ]] ファイル

#### オプション

- -R : 指定ディレクトリ以下を再帰的に変更

### 指定のパターン

- 所有者を変更

chown ユーザー ファイル

- 所有者と所有グループを変更

chown ユーザー:グループ ファイル

- 所有グループのみ変更

chown :グループ ファイル

#### 実行例

```bash

$ chown sato test
chown: 'test' の所有者を変更中: 許可されていない操作です

$ sudo chown sato test

$ ls -l test
-rw-r--r--. 1 sato linuc 0 8月16 10:44 test

```

- 一般ユーザーは直接変更できないため、sudo が必要

- 所有者が sato に変更されたことが確認できる

### 注意点

- 他人が所有するファイルを削除しようとすると確認が必要になる

```bash

$ rm test
rm: 書き込み保護されたファイル 'test' を削除しますか? y

```

---

### 6-1-3 所有グループの変更

#### 概要

- ファイルの **所有グループ** を変更するには `chgrp` コマンドを使う。
- 一般ユーザーは **自分が所属しているグループのみ** に変更できる。
- `sudo` を使えば **任意のグループ** に変更可能。

---

#### コマンド書式

chgrp [オプション] グループ ファイル

#### 主なオプション

- -R
- ディレクトリ内のファイルやディレクトリの所有グループを 再帰的に変更

#### 実行例

1. ユーザー情報確認

```bash

$ id
uid=1000(linuc) gid=1000(linuc) groups=1000(linuc),10(wheel)

```

2. ディレクトリ作成 & 所有グループ変更

```bash

$ mkdir testdir

$ chgrp wheel testdir

$ ls -ld testdir

drwxr-xr-x. 2 linuc wheel 6  8月16 10:57 testdir

```

- 所属グループ wheel に変更成功

3. 所属していないグループに変更

```bash

$ chgrp kvm testdir
chgrp: 'testdir' のグループを変更中: 許可されていない操作です


```

- 所属していないグループ kvm には変更不可

#### ポイントまとめ

- chgrp … ファイル/ディレクトリの所有グループ変更

- 一般ユーザー → 所属グループにのみ変更可能

- root 権限（sudo） → すべてのグループに変更可能

---

## 6-2 ファイルとアクセス権

## 概要

- ファイルのアクセス権は以下の 3 種類がある
  1. **読み込み (Read, r)**
  2. **書き込み (Write, w)**
  3. **実行 (eXecute, x)**
- アクセス権は **所有者、所有グループ、その他のユーザー** に対して設定可能
- ファイルのアクセス権は **パーミッション** または **モード** と呼ばれる
- 変更する場合は `chmod` コマンドを使用

---

### 6-2-1 アクセス権を確認する

- ファイルのモードは `ls -l` で確認可能
- 左端の文字列がアクセス権を示す

<img src="images/8進数によるアクセス権.png" alt="Top picture" width="600">

- 最初の `-` … ファイルの種類（`d` はディレクトリ）
- その後の 3 文字ごとに、**所有者 / 所有グループ / その他** のアクセス権を示す

## アクセス権の数値対応

| 権限 | 8 進数 |
| ---- | ------ |
| r    | 4      |
| w    | 2      |
| x    | 1      |

- 合計値を計算して `chmod` で設定可能
  - 例: `rwx` → 4+2+1 = 7
  - `rw-` → 4+2+0 = 6

---

## アクセス権の意味

- **r**: ファイルの読み込み可能 / ディレクトリの中身確認可能
- **w**: ファイルの書き込み可能 / ディレクトリ内の作成・削除可能
- **x**: ファイルをプログラムとして実行可能 / ディレクトリに入れる

---
