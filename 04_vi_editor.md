# 第 4 章 vi エディタの基礎

## 章の概要

本章では、UNIX/Linux で広く使われるモーダル型エディタ **vi（および Vim）** の基礎操作を学びます。

- vi のモード構造（編集モード・入力モード）
- 基本的な起動・保存・終了方法
- 入力・編集・カーソル移動・検索操作
- 編集作業（文字・行の削除・コピー・ペースト・書き換え・アンドゥ）

これらを習得することで、設定ファイル編集やプログラム作成時に効率よく作業できます。

---

# 目次

- [第 4 章 vi エディタの基礎](#第4章-vi-エディタの基礎)
  - [4.1 vi はモーダル型エディタ](#41-vi-はモーダル型エディタ)
  - [4.2 vi の基本的な使用方法](#42-vi-の基本的な使用方法)
    - [4.2.1 vi の起動](#421-vi-の起動)
    - [4.2.2 入力モードへの切替](#422-入力モードへの切替)
    - [4.2.3 編集モードへの切替](#423-編集モードへの切替)
    - [4.2.4 ファイル保存](#424-ファイル保存)
    - [4-2-5 vi の終了](#4-2-5-vi-の終了)
    - [4-2-6 ファイルが未保存の状態から終了する](#4-2-6-ファイルが未保存の状態から終了する)
    - [4-2-7 ZZ で保存終了する](#4-2-7-zz-で保存終了する)
  - [4-3 入力モードへの切替（応用）](#4-3-入力モードへの切替応用)
    - [4-3-1 行の先頭に入力](#4-3-1-行の先頭に入力)
    - [4-3-2 カーソルの後ろ・行末から入力](#4-3-2-カーソルの後ろ行末から入力)
    - [4-3-3 カーソルの前後の行から入力](#4-3-3-カーソルの前後の行から入力)
  - [4-4 カーソルの移動](#4-4-カーソルの移動)
    - [4-4-1 1 文字単位の移動（編集モード）](#4-4-1-1-文字単位の移動編集モード)
    - [4-4-2 行頭・行末への移動](#4-4-2-行頭行末への移動)
    - [4-4-3 文書先頭・末尾への移動](#4-4-3-文書先頭末尾への移動)
  - [4-5 入力モードでのカーソル移動](#4-5-入力モードでのカーソル移動)
    - [4-5-1 ページ単位の移動](#4-5-1-ページ単位の移動)
    - [4-5-2 行番号指定で移動](#4-5-2-行番号指定で移動)
  - [4-6 様々な編集操作](#4-6-様々な編集操作)
    - [4-6-1 基本コマンド一覧](#4-6-1-基本コマンド一覧)
    - [4-6-2 文字のカット＆ペースト](#4-6-2-文字のカット＆ペースト)
    - [4-6-3 行のカット＆ペースト](#4-6-3-行のカット＆ペースト)
    - [4-6-4 行のコピー＆ペースト](#4-6-4-行のコピー＆ペースト)
    - [4-6-5 1 文字の書き換え](#4-6-5-1-文字の書き換え)
    - [4-6-6 単語の書き換え](#4-6-6-単語の書き換え)
    - [4-6-7 アンドゥによる編集作業の取り消し](#4-6-7-アンドゥによる編集作業の取り消し)
  - [4-7 検索](#4-7-検索)
    - [4-7-1 検索に関する基本コマンド](#4-7-1-検索に関する基本コマンド)
    - [4-7-2 文字列の検索手順](#4-7-2-文字列の検索手順)

---

## 4.1 vi はモーダル型エディタ

- **モーダル型**：モードがあり、操作がモードによって変わる。
- **編集モード**：カーソル移動、文字削除、コピー・ペーストなどを行う。
- **入力モード**：文字入力や削除を行う。モードレス型エディタと似た操作感。
- vi は多くの UNIX 環境に標準搭載されており、設定ファイル編集に必須。
- 現在はオリジナル vi ではなく、機能改善された**vim（Vi IMproved）**が主流。

## 4.2 vi の基本的な使用方法

- モードの切り替えや保存・終了の方法がモードレス型エディタと異なる。
- 基本的な流れ：
  1. vi コマンドでファイルを開く。
  2. 入力モード・編集モードを切り替えて作業する。
  3. 保存・終了を行う。

---

### 4.2.1 vi の起動

- 書式：

  vi [ファイル名]

指定ファイルが存在しない場合は、新規作成される。

ファイル名未指定の場合、保存時に名前を入力する必要がある。

```bash

$ vi test.txt

```

![Alt text](images/vi%E7%B7%A8%E9%9B%86%E3%83%A2%E3%83%BC%E3%83%89.png)

---

## 4.2.2 入力モードへの切替

- vi 起動直後は**編集モード**。
- 入力モードへは `i`（Insert）を押す。
- 画面左下に「-- 挿入 --」が表示されたら入力可能。
- 入力モードでは `BackSpace` や `Delete` で文字削除可。
- vim では入力モード中でもカーソルキーで移動可能。

![Alt text](images/%E5%85%A5%E5%8A%9B%E3%83%A2%E3%83%BC%E3%83%89.png)

---

## 4.2.3 編集モードへの切替

- 入力モードから編集モードへは `Esc` を押す。
- 「-- 挿入 --」表示が消えたら編集モード。
- 状態が分からなくなったら、とりあえず `Esc` を押して編集モードに戻す。

---

## 4.2.4 ファイル保存

- 編集モードで `:` を押すとコマンド入力モードに。
- 保存は `w`（Write）コマンド。

新しく作成したファイルの場合、画面左下に「“test.txt”[新] xL, xB 書込み」と表示されて、新しくファイルが作
成されたことが分かります。

![Alt text](images/%E6%9B%B8%E3%81%8D%E8%BE%BC%E3%81%BF%E5%AE%8C%E4%BA%86.png)

---

## 4-2-5 vi の終了

- 編集モードで `:q`（Quit）を入力すると終了。
- 正常終了時はコマンドラインに戻る。

---

## 4-2-6 ファイルが未保存の状態から終了する

- 未保存時に `:q` すると警告が出て終了できない。
- **保存して終了**：`:wq`
- **保存せず終了**：`:q!`（変更を破棄）

---

## 4-2-7 ZZ で保存終了する

- `:wq` と同様に保存して終了するが、挙動が異なる。
  - `:wq` → 変更がなくても保存（タイムスタンプ更新）
  - `ZZ` → 変更がある場合のみ保存（変更なしなら保存せず終了）
- タイムスタンプ管理が必要なファイル（例：ソースコード）では `ZZ` の利用が便利。

### よく使う流れ

```bash

$ vi test.txt    # ファイルを開く
i                # 入力モードで編集
Esc              # 編集モードに戻る
:wq              # 保存して終了

```

---

# 4-3 入力モードへの切替（応用）

## 4-3-1 行の先頭に入力

- 編集モードから入力モードに入る方法は `i` 以外にも複数ある。
- `i`：カーソル位置から入力。
- `I`（Shift+i）：カーソルがどこにあっても行頭へ移動して入力モードに入る。
- 用途に応じて使い分けると効率的。

---

## 4-3-2 カーソルの後ろ・行末から入力

- `a`（Append）：カーソル位置の**1 文字右**に移動して入力モードへ。
- `A`（Shift+a）：カーソル位置に関係なく、**行末**へ移動して入力モードへ。

---

## 4-3-3 カーソルの前後の行から入力

- `o`：カーソルの**下の行**に空行を挿入して入力モードへ。
- `O`（Shift+o）：カーソルの**上の行**に空行を挿入して入力モードへ。

---

# 4-4 カーソルの移動

## 4-4-1 1 文字単位の移動（編集モード）

- `h`：左へ移動
- `j`：下へ移動
- `k`：上へ移動
- `l`：右へ移動
- キーボードの並びで `h` が左端、`l` が右端にあるため覚えやすい。
- vim ではカーソルキーでも移動可能。

---

## 4-4-2 行頭・行末への移動

- `0`（ゼロ）：行頭へ移動
- `$`：行末へ移動

---

## 4-4-3 文書先頭・末尾への移動

- `gg`：文書先頭（1 行目）へ移動
- `G`（Shift+g）：文書末尾（最終行）へ移動

---

## 4-5 入力モードでのカーソル移動

---

### 4-5-1 ページ単位の移動

- `Ctrl+f`（Forward）：次ページへ移動
- `Ctrl+b`（Backward）：前ページへ移動

---

### 4-5-2 行番号指定で移動

- `:数値`：指定した行番号に移動
  - 例：`:10` → 10 行目に移動

---

# 4-6 様々な編集操作

編集モードでは、文字や行の削除・コピー・カット＆ペースト・書き換え・アンドゥが可能です。

---

## 4-6-1 基本コマンド一覧

| コマンド | 内容                           |
| -------- | ------------------------------ |
| `x`      | 1 文字削除（バッファに格納）   |
| `dd`     | 1 行削除（バッファに格納）     |
| `yy`     | 1 行コピー（ヤンク）           |
| `p`      | カーソルの後ろにペースト       |
| `P`      | カーソルの前にペースト         |
| `r`      | カーソル位置の文字を書き換え   |
| `cw`     | カーソル位置から単語を書き換え |
| `u`      | 編集作業の取り消し（Undo）     |

---

## 4-6-2 文字のカット＆ペースト

- `x`：文字を削除しバッファに格納
- `p`：カーソルの後ろにペースト
- `P`：カーソルの前にペースト

---

## 4-6-3 行のカット＆ペースト

- `dd`：行削除 → バッファに格納
- `p`：削除した行をカーソル下にペースト
- `P`：削除した行をカーソル上にペースト

---

## 4-6-4 行のコピー＆ペースト

- `yy`：行をコピー（ヤンク）
- `p`：コピー行をカーソル下にペースト
- `P`：コピー行をカーソル上にペースト

---

## 4-6-5 1 文字の書き換え

- `r`：カーソル位置の 1 文字を書き換え
- 表示は変わらず、入力した文字で置き換えられる

---

## 4-6-6 単語の書き換え

- `cw`：カーソル位置から単語末まで削除し、入力モードに切替
- 英語では空白で単語区切り判定、日本語は単語判定が難しい

---

## 4-6-7 アンドゥによる編集作業の取り消し

- `u`：直前の編集作業を取り消す
- 繰り返し入力すると、一番最初の無編集状態まで戻せる

---

# 4-7 検索

編集モードで `/` コマンドを使うと文字列を検索し、カーソルを移動できます。

## 4-7-1 検索に関する基本コマンド

| コマンド      | 内容                           |
| ------------- | ------------------------------ |
| `/検索文字列` | 指定した文字列を検索           |
| `n`           | 下方向へ再検索（次の一致箇所） |
| `N`           | 上方向へ再検索（前の一致箇所） |

---

## 4-7-2 文字列の検索手順

1. 編集モードで `/` を入力 → 左下に `/` 表示
2. 検索したい文字列を入力し Enter
3. カーソルが該当文字列に移動
4. 複数ある場合
   - `n` → 下方向の次を検索
   - `N` → 上方向の前を検索
5. 最終行まで到達すると「下まで検索したので上に戻ります」と表示され最初に戻る
6. 検索文字列はハイライト表示される
   - ハイライトを消す場合：`:nohlsearch`

---
